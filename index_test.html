<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="d3/d3.min.js"></script>
	<script src="scripts/dataProcessing.js"></script>
	<script src="scripts/d3CheckBox.js"></script>
	<script src="scripts/Ranking.js"></script>
	<script src="scripts/radarChart.js"></script>
	<title>Projet DataVis WYEIWYA</title>
	<style type="text/css">
		.x-axis path {
			stroke:white;
			fill:none;
		}
		.x-axis line {
			fill: none;
			stroke: none;
			stroke-opacity:.8;
			shape-rendering: crispEdges;
		}
		.bars rect {
			fill:steelblue;
			fill-opacity:.9;
			border : white 1px solid;
		}
		.title {
			font-weight: bold;
		}
		#precise-value {
			fill:white;
			font-size: 12px;
		}
		
		div.tooltip {
			color: #222;
			background-color: #fff;
			padding: .5em;
			text-shadow: #f5f5f5 0 1px 0;
			border-radius: 2px;
			opacity: 0.9;
			position: absolute;
		}
</style>
</head>
<body>
	<div id="scatterplot"></div>
	<div id="RankingDiv"><form>
	  <label><input type="radio" name="mode" value="0" checked>Fat</label>
	  <label><input type="radio" name="mode" value="1">Saturated fat</label>
	  <label><input type="radio" name="mode" value="2">Cholesterol</label>
	  <label><input type="radio" name="mode" value="3">Carbohydrates</label>
	  <label><input type="radio" name="mode" value="4">Fibers</label>
	  <label><input type="radio" name="mode" value="5">Sugars</label>
	</form>
	</div>
	<div id="SpiderDiv"></div>
	<script type="text/javascript">
	var rankingChart;
	
		d3.csv("data/food_data.csv", function(error,data) {
	// Test
	if (error){console.log(error)}
	
	else{
		// Save data
		var dataset = data;
		ByCountry = dataProcessing(data)
		
		console.log(ByCountry);
		
		//******************************//
		//		General parameters		//
		//******************************//
		//
		// References :
		// - http://bl.ocks.org/leondutoit/6436923
		//
		var window_w = window.innerWidth;
		var margin = {top: 5, right: 0.05*window_w, bottom: 30, left: 0.05*window_w};
		var width = window_w - margin.left - margin.right;	// Percentage
		var height = 1500 - margin.top - margin.bottom;			// Percentage

		var svgRanking = d3.select("#RankingDiv")
		//**********************************//	
		// 	Initialize Ranking and Geomap	//
		//**********************************//
	/*	rankingChart = rankingInit(ByCountry,0, svgRanking,width,height,margin,1700);

		d3.selectAll("input")
			.on("change", changed);
		
		// resize the chart on resizing window
		window.addEventListener('resize', rankingChart.render);
		*/
		//**********************************//
		//		Input listener function		//
		//**********************************//
	/*	
		function changed() {
			try{
				rankingChart.rankingUpdate(+this.value);
				}

			catch(error){
				console.log(error)
				rankingChart.rankingUpdate(0)}
				}
	*/	//**********************************//
		//			Radar Chart 			//
		//**********************************//
		var spiderVar = [];
		var max = [3410, 1200, 2, 6930, 410, 4200, 1400, 630, 250, 0.55, 2.7, 19, 0.3641, 307000, 2000]
		ByCountry.forEach(function(country){
			var c = []
			country.means.forEach(function(crit,i){
				c.push({axis:i,value:100*crit/max[i]});
			});
			spiderVar.push(c);
		});
		
		
		var w = 500,
		h = 500;

		var colorscale = d3.scaleOrdinal(d3.schemeCategory10);

		//Legend titles
		var LegendOptions = ['Smartphone','Tablet'];
		
		//Options for the Radar chart, other than default
		var mycfg = {
		  w: w,
		  h: h,
		  maxValue: 0.6,
		  levels: 6,
		  ExtraWidthX: 300
		}

		//Call function to draw the Radar chart
		//Will expect that data is in %'s
		RadarChart.draw("#SpiderDiv", spiderVar, mycfg);

		////////////////////////////////////////////
		/////////// Initiate legend ////////////////
		////////////////////////////////////////////

		var svg = d3.select('#body')
			.selectAll('svg')
			.append('svg')
			.attr("width", w+300)
			.attr("height", h)

		//Create the title for the legend
		var text = svg.append("text")
			.attr("class", "title")
			.attr('transform', 'translate(90,0)') 
			.attr("x", w - 70)
			.attr("y", 10)
			.attr("font-size", "12px")
			.attr("fill", "#404040")
			.text("What % of owners use a specific service in a week");
				
		//Initiate Legend	
		var legend = svg.append("g")
			.attr("class", "legend")
			.attr("height", 100)
			.attr("width", 200)
			.attr('transform', 'translate(90,20)') 
			;
			//Create colour squares
			legend.selectAll('rect')
			  .data(LegendOptions)
			  .enter()
			  .append("rect")
			  .attr("x", w - 65)
			  .attr("y", function(d, i){ return i * 20;})
			  .attr("width", 10)
			  .attr("height", 10)
			  .style("fill", function(d, i){ return colorscale(i);})
			  ;
			//Create text next to squares
			legend.selectAll('text')
			  .data(LegendOptions)
			  .enter()
			  .append("text")
			  .attr("x", w - 52)
			  .attr("y", function(d, i){ return i * 20 + 9;})
			  .attr("font-size", "11px")
			  .attr("fill", "#737373")
			  .text(function(d) { return d; })
			  ;	
	  
// End of Data processing
}});
	</script>
</body>
</html>

<!--Palette de couleur, tootip à droite, transition plus rapide, ajouter un truc pour voir comment les pays sont montés ou descendus (-->