<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="d3/d3.min.js"></script>
	<script src="scripts/dataProcessing.js"></script>
	<script src="scripts/d3CheckBox.js"></script>
	<script src="scripts/Ranking.js"></script>
	<title>Projet DataVis WYEIWYA</title>
	<style type="text/css">
		.x-axis path {
			stroke:white;
			fill:none;
		}
		.x-axis line {
			fill: none;
			stroke: none;
			stroke-opacity:.8;
			shape-rendering: crispEdges;
		}
		.bars rect {
			fill:steelblue;
			fill-opacity:.9;
			border : white 1px solid;
		}
		.title {
			font-weight: bold;
		}
		#precise-value {
			fill:white;
			font-size: 12px;
		}
		
		div.tooltip {
			color: #222;
			background-color: #fff;
			padding: .5em;
			text-shadow: #f5f5f5 0 1px 0;
			border-radius: 2px;
			opacity: 0.9;
			position: absolute;
		}
</style>
</head>
<body>
	<div id="scatterplot"></div>
	<div id="ranking"><form>
	  <label><input type="radio" name="mode" value="0" checked>Fat</label>
	  <label><input type="radio" name="mode" value="1">Saturated fat</label>
	  <label><input type="radio" name="mode" value="2">Cholesterol</label>
	  <label><input type="radio" name="mode" value="3">Carbohydrates</label>
	  <label><input type="radio" name="mode" value="4">Fibers</label>
	  <label><input type="radio" name="mode" value="5">Sugars</label>
	</form>
</div>
	<script type="text/javascript">
	var rankingChart;
	
		d3.csv("data/food_data.csv", function(error,data) {
	// Test
	if (error){console.log(error)}
	
	else{
		// Save data
		var dataset = data;
		ByCountry = dataProcessing(data)
		
		console.log(ByCountry);
		
		//******************************//
		//		Countries ranking		//
		//******************************//

		// References :
		// - http://bl.ocks.org/leondutoit/6436923
		var window_w = window.innerWidth;
		var margin = {top: 5, right: 0.05*window_w, bottom: 30, left: 0.05*window_w};
		var width = window_w - margin.left - margin.right;	// Percentage
		var height = 2000 - margin.top - margin.bottom;			// Percentage

		var svg2 = d3.select("#ranking")
			.append("svg")
			.attr("width","100%")
			.attr("height",1500);
			
		// Create ranking
		rankingChart = rankingInit(ByCountry,0, svg2,width,height,margin,1500);
		
		d3.selectAll("input")
			.on("change", changed);
		
		// resize the chart on resizing window
		window.addEventListener('resize', rankingChart.render);
		
		//**********************************//
		//		Input listener function		//
		//**********************************//	

		function changed() {
			try{
				rankingChart.rankingUpdate(+this.value);
				}

			catch(error){
				console.log(error)
				rankingChart.rankingUpdate(0)}
				}
		
// End of Data processing
}});
	</script>
</body>
</html>