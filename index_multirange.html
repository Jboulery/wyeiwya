<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="css/fontawesome-all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.2.1.slim.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="d3/d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/bootstrap-slider.min.js"></script>
	<script src="scripts/dataProcessing.js"></script>
	<script src="scripts/d3CheckBox.js"></script>
	<script src="scripts/Ranking.js"></script>
	<script src="scripts/geomap.js"></script>
	<script src="scripts/radarChart.js"></script>
	<script src="scripts/radarChartScript.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
	<script src="scripts/multirange_slider.js"></script>
	<script src="scripts/CurrentArray.js"></script>
	<title>Projet DataVis WYEIWYA</title>
</head>
<body>
	<nav class="navbar navbar-expand-md navbar-light">
		<ul class="navbar-nav ml-auto">
			<li class="nav-item" id="slider">
				<script>sliderInit()</script>
			</li>
	    </ul>
	    <ul class="navbar-nav mr-auto">
		    <li class="nav-item offset-sm-2">
				<button class="btn btn-success" id="modify_weights_btn" onclick="get_sliders_distribution()">
					Apply
				</button>
			</li>
	    </ul>
	    <ul class="navbar-nav ml-auto">
	    	<li class="nav-item">
				<button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#helpModal">
					Help
				</button>
			</li>	
	    </ul>
	</nav>

    <!-- Page Content -->
    <div id="page-content-wrapper">

    	<div class="row" style="height: 100%">
    		<div class="col-sm-9" style="height: 100%">
      			<div class="row" id="ranking-table-wrapper">
      				<div class="container-fluid" id="RankingDiv" style="overflow : scroll">
      				</div>
      			</div>
      			<div class="row" id="world-map-wrapper">
      				<div class="container-fluid" id="world-map" style="overflow : scroll"></div>
      			</div>
        	</div>
        	<div class="col-sm-3" id="right-side-bar">
        		<div id="SpiderDiv" style="width: 100%; height : 50%">
        			
        		</div>
        		<div class="rect" id="ScatterplotDiv">
        			
        		</div>
        	</div>
    	</div>

    </div>

    <div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="helpModalLabel" aria-hidden="true">
    	<div class="modal-dialog" role="document">
    		<div class="modal-content">
    			<div class="modal-header">
    				<h5 class="modal-title" id="helpModalLabel">Need some help ?</h5>
    				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
    					<span aria-hidden="true">&times;</span>
    				</button>
    			</div>
    			<div class="modal-body">
    				Welcome to our DataViz WYEIWYA Project ! </br>
    				*version provisoire avec des id√©es* </br> 
    				Authors :  </br>
    				<a href="https://github.com/RaphAllier"> Raphael Allier </a></br>
    				<a href="https://github.com/Jboulery"> Jeremy Boulery </a></br>
    				<a href="https://github.com/ValentinCrr"> Valentin Carra </a> </br>

    			Ever wonder which country eats the healthiest food ? You're going on a trip to Phillipines and you worry that you won't be able to keep on with your diet ? This data visualization project will give you all the answers. </br>

    			Based on a database provided by <a href="https://world.openfoodfacts.org/"> OpenFoodFacts </a>, we created a visualization that allows you to see which country in the world eats the fattest food or the sweetest one.  </br>

    			The main part of the visualization tool is the ranking section, which shows you the countries extracted from the database ranked according to a criteria based on user input. We extract nutritional values from the database, and the slider in the top part of the page allows you to give more or less weight to those neutritionnal values in the ranking. </br>

    			On the bottom part of the page, a world map allows you to see the countries ranked above colored according to their rank. </br>

    			On the right side, a radar chart allows you to visualize and compare the raw nutritional values of a given country with another one. To do so, just click on the rectangle beside the desired country in the ranking, and its radar chart will appear on the right. </br>

    			</div>
    			<div class="modal-footer">
    				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    			</div>
    		</div>
    	</div>
	</div>

	<script type="text/javascript">
		var rankingChart;
		var map;
			d3.csv("data/food_data.csv", function(error,data) {
		// Test
		if (error){console.log(error)}
		
		else{
			// Save data
			var dataset = data;
			var MinProducts = 10;
			ByCountry = dataProcessing(data,MinProducts)


			
			//******************************//
			//		General parameters		//
			//******************************//
			//
			// References :
			// - http://bl.ocks.org/leondutoit/6436923
			//
			var svgRanking = d3.select("#RankingDiv")
			var svgMap = d3.select("#world-map")
			//
			var window_w = svgRanking.node().getBoundingClientRect().width;
			var margin = {top: 5, right: 0.05*window_w, bottom: 30, left: 0.01*window_w};
			var width = window_w - margin.left - margin.right;	// Percentage
			var height = 1500 - margin.top - margin.bottom;			// Percentage

			// Get proportions and initialize array

			prop = get_sliders_distribution();
			UpdateByCountry(ByCountry,prop);

			//**********************************//	
			// 	Initialize Ranking, Geomap and Spider	//
			//**********************************//
			spiderChart = radarChartInit(ByCountry,"#SpiderDiv");
			rankingChart = rankingInit(ByCountry, svgRanking,height,margin,1700,spiderChart);
			map = GeoInit(ByCountry, svgMap,width);

			d3.selectAll("#modify_weights_btn")
				.on("click", changed);

			
			// resize the chart on resizing window
			window.addEventListener('resize', rankingChart.render);
			
			//**********************************/
			//		Input listener function		//
			//**********************************//	

			function changed() {
				try{
					prop = get_sliders_distribution();
					UpdateByCountry(ByCountry,prop);
					rankingChart.rankingUpdate(ByCountry);
					map.GeoUpdate(ByCountry);
					}

				catch(error){
					console.log(error);
					}
			
	// End of Data processing
	}}});
	</script>
</body>
</html>